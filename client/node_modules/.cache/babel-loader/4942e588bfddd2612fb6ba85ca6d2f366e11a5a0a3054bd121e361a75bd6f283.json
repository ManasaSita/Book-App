{"ast":null,"code":"import React,{useState,useEffect}from'react';import{getBookWithStatus,addReview,getReviews,editReview,deleteReview}from'../services/api';import{useParams,Link}from'react-router-dom';import{useAuth}from'../context/AuthContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const BookDetail=()=>{const[book,setBook]=useState(null);const[isAddingReview,setIsAddingReview]=useState(false);const[isEditing,setIsEditing]=useState(false);const[reviewText,setReviewText]=useState('');const[showMore,setShowMore]=useState(false);const[reviewToEdit,setReviewToEdit]=useState(null);// Track the review being edited\nconst{bookId}=useParams();const{user}=useAuth();const userId=user.payload.user.id;useEffect(()=>{fetchBook();fetchReview();},[bookId]);const fetchBook=async()=>{try{const fetchedBook=await getBookWithStatus(bookId,userId);setBook(fetchedBook);setReviewText(fetchedBook.review||'');setReviewToEdit(fetchedBook.review||'');}catch(error){console.error('Error fetching book:',error);}};const fetchReview=async()=>{await getReviews(bookId);};const handleReviewChange=e=>{setReviewText(e.target.value);};const handleAddReview=async()=>{try{await addReview(userId,bookId,reviewText);setReviewText('');setIsAddingReview(false);fetchBook();}catch(error){console.error('Error adding review:',error);}};const handleEditReview=async()=>{try{await editReview(userId,bookId,reviewText);setIsEditing(false);setReviewToEdit(reviewText);fetchBook();}catch(error){console.error('Error editing review:',error);}};const handleDeleteReview=async()=>{try{await deleteReview(userId,bookId);setReviewText('');setReviewToEdit('');fetchBook();}catch(error){console.error('Error deleting review:',error);}};const toggleShowMore=()=>{setShowMore(!showMore);};if(!book)return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});const description=book.description||'';const maxLength=250;const isTruncated=description.length>maxLength;const displayText=showMore?description:`${description.substring(0,maxLength)}...`;return/*#__PURE__*/_jsxs(\"div\",{className:\"book-detail\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"book-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"image\",children:/*#__PURE__*/_jsx(\"img\",{src:book.thumbnail,alt:book.title})}),/*#__PURE__*/_jsxs(\"div\",{className:\"content\",children:[/*#__PURE__*/_jsx(\"h2\",{children:book.title}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Author: \",book.author]}),/*#__PURE__*/_jsxs(\"div\",{className:\"description-box\",children:[\"Description:\",/*#__PURE__*/_jsx(\"p\",{className:\"description\",children:displayText}),isTruncated&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowMore(!showMore),children:showMore?'Show Less':'Show More'})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Rating: \",book.rating]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Status: \",book.status]}),reviewToEdit?/*#__PURE__*/_jsx(\"div\",{className:\"review-container\",children:isEditing?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Edit your review\",value:reviewText,onChange:handleReviewChange}),/*#__PURE__*/_jsx(\"button\",{onClick:handleEditReview,children:\"Save Review\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsEditing(false),children:\"Cancel\"})]}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Your Review:\"}),/*#__PURE__*/_jsx(\"p\",{children:reviewToEdit}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsEditing(true),children:\"Edit Review\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleDeleteReview,children:\"Delete Review\"})]})}):/*#__PURE__*/_jsx(\"div\",{children:isAddingReview?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Add your review\",value:reviewText,onChange:handleReviewChange}),/*#__PURE__*/_jsx(\"button\",{onClick:handleAddReview,children:\"Add Review\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsAddingReview(false),children:\"Cancel\"})]}):/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsAddingReview(true),children:\"Add Review\"})})]})]}),/*#__PURE__*/_jsx(Link,{to:\"/books\",children:/*#__PURE__*/_jsx(\"button\",{children:\"Back to List\"})})]});};export default BookDetail;","map":{"version":3,"names":["React","useState","useEffect","getBookWithStatus","addReview","getReviews","editReview","deleteReview","useParams","Link","useAuth","jsx","_jsx","jsxs","_jsxs","BookDetail","book","setBook","isAddingReview","setIsAddingReview","isEditing","setIsEditing","reviewText","setReviewText","showMore","setShowMore","reviewToEdit","setReviewToEdit","bookId","user","userId","payload","id","fetchBook","fetchReview","fetchedBook","review","error","console","handleReviewChange","e","target","value","handleAddReview","handleEditReview","handleDeleteReview","toggleShowMore","children","description","maxLength","isTruncated","length","displayText","substring","className","src","thumbnail","alt","title","author","onClick","rating","status","type","placeholder","onChange","to"],"sources":["/home/manasa/Projects/UpGrad/Project/bookShelf/client/src/components/BookDetail.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { getBookWithStatus, addReview, getReviews, editReview, deleteReview } from '../services/api';\nimport { useParams, Link } from 'react-router-dom';\nimport { useAuth } from '../context/AuthContext';\n\nconst BookDetail = () => {\n  const [book, setBook] = useState(null);\n  const [isAddingReview, setIsAddingReview] = useState(false);\n  const [isEditing, setIsEditing] = useState(false);\n  const [reviewText, setReviewText] = useState('');\n  const [showMore, setShowMore] = useState(false);\n  const [reviewToEdit, setReviewToEdit] = useState(null); // Track the review being edited\n  const { bookId } = useParams();\n  const { user } = useAuth();\n  const userId = user.payload.user.id;\n\n  useEffect(() => {\n    fetchBook();\n    fetchReview();\n  }, [bookId]);\n\n  const fetchBook = async () => {\n    try {\n      const fetchedBook = await getBookWithStatus(bookId, userId);\n      setBook(fetchedBook);\n      setReviewText(fetchedBook.review || '');\n      setReviewToEdit(fetchedBook.review || '');\n    } catch (error) {\n      console.error('Error fetching book:', error);\n    }\n  };\n\n  const fetchReview = async () => {\n    await getReviews(bookId);\n  }\n\n  const handleReviewChange = (e) => {\n    setReviewText(e.target.value);\n  };\n\n  const handleAddReview = async () => {\n    try {\n      await addReview(userId, bookId, reviewText);\n      setReviewText('');\n      setIsAddingReview(false);\n      fetchBook();\n    } catch (error) {\n      console.error('Error adding review:', error);\n    }\n  };\n\n  const handleEditReview = async () => {\n    try {\n      await editReview(userId, bookId, reviewText);\n      setIsEditing(false);\n      setReviewToEdit(reviewText);\n      fetchBook();\n    } catch (error) {\n      console.error('Error editing review:', error);\n    }\n  };\n\n  const handleDeleteReview = async () => {\n    try {\n      await deleteReview(userId, bookId);\n      setReviewText('');\n      setReviewToEdit('');\n      fetchBook();\n    } catch (error) {\n      console.error('Error deleting review:', error);\n    }\n  };\n  \n  const toggleShowMore = () => {\n    setShowMore(!showMore);\n  };\n\n  if (!book) return <div>Loading...</div>;\n\n  const description = book.description || '';\n  const maxLength = 250;\n  const isTruncated = description.length > maxLength;\n  const displayText = showMore ? description : `${description.substring(0, maxLength)}...`;\n\n  return (\n    <div className='book-detail'>\n      <div className='book-content'>\n        <div className='image'>\n          <img src={book.thumbnail} alt={book.title} />\n        </div>\n        <div className='content'>\n          <h2>{book.title}</h2>\n          <p>Author: {book.author}</p>\n          <div className=\"description-box\">\n            Description:\n            <p className='description'>{displayText}</p>\n            {isTruncated && (\n              <button onClick={() => setShowMore(!showMore)}>\n                {showMore ? 'Show Less' : 'Show More'}\n              </button>\n            )}\n          </div>\n          \n          <p>Rating: {book.rating}</p>\n          <p>Status: {book.status}</p>\n\n            {reviewToEdit ? (\n                <div className=\"review-container\">\n                {isEditing ? (\n                    <div>\n                    <input\n                        type='text'\n                        placeholder=\"Edit your review\"\n                        value={reviewText}\n                        onChange={handleReviewChange}\n                    />\n                    <button onClick={handleEditReview}>Save Review</button>\n                    <button onClick={() => setIsEditing(false)}>Cancel</button>\n                    </div>\n                ) : (\n                    <div>\n                    <h3>Your Review:</h3>\n                    <p>{reviewToEdit}</p>\n                    <button onClick={() => setIsEditing(true)}>Edit Review</button>\n                    <button onClick={handleDeleteReview}>Delete Review</button>\n                    </div>\n                )}\n                </div>\n            ) : (\n                <div>\n                {isAddingReview ? (\n                    <div>\n                    <input\n                        type='text'\n                        placeholder=\"Add your review\"\n                        value={reviewText}\n                        onChange={handleReviewChange}\n                    />\n                    <button onClick={handleAddReview}>Add Review</button>\n                    <button onClick={() => setIsAddingReview(false)}>Cancel</button>\n                    </div>\n                ) : (\n                    <button onClick={() => setIsAddingReview(true)}>Add Review</button>\n                )}\n                </div>\n            )}\n        </div>\n      </div>\n\n      <Link to=\"/books\">\n        <button>Back to List</button>\n      </Link>\n    </div>\n  );\n};\n\nexport default BookDetail;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}